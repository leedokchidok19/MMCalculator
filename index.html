<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Man Month Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <header>
        <nav>
            <h1>Man Month Calculator</h1>
        </nav>
    </header>

    <section>
        <div id="mm_title" class="row w-100">
            <h1 class="my-auto" data-tooltip="man-month란 프로젝트에 투입되는 월인원이다">맨먼스(M/M)란?</h1>
        </div>
        <div class="row w-100">
            <div class="row w-50">
                <div class="grade">
                    <span>초급 :</span>
                    <input type="text" value="1">
                    <span>만원</span>
                </div>
                <div class="grade">
                    <span>중급 :</span>
                    <input type="text" value="1">
                    <span>만원</span>
                </div>
                <div class="grade">
                    <span>고급 :</span>
                    <input type="text" value="1">
                    <span>만원</span>
                </div>
            </div>
            <div class="row w-50">
                <div class="add_row">
                    <span id="add_btn">Add</span>
                    <input id="add_rows" type="text" value="1">Row(s)
                </div>
            </div>
        </div>
        <div class="row my-auto w-100">
            <table class="w-100 description">
                <thead>
                    <tr>
                        <th>번호</th>
                        <th>등급</th>
                        <th>투입 인원</th>
                        <th>투입 기간</th>
                        <th>합계</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>1</th>
                        <td>
                            <select id="g_1" class="options">
                                <option value="1">초급</option>
                            </select>
                        </td>
                        <td>
                            <input id="p_1" class="options" type="number" value="1">
                            <span class="mm">M</span>
                        </td>
                        <td>
                            <input id="m_1" class="options" type="number" value="1">
                            <span class="mm">M</span>
                        </td>
                        <td>
                            <input id="r_1" class="options" type="number">
                            <span class="mm">M/M</span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="row result">
            <span>총 합계 : </span>
            <input id="total" type="text" readonly>
            <span class="mm">M/M</span>
        </div>
    </section>
    <footer>
        <article>
            <div id="toggle">
                <div class="my-auto triangle">
                    <p>펼치기</p>
                </div>
                <!--<img src="./img/triangle-240.png" alt="triangle">-->
            </div>
            <img id="price" src="./img/price-table-2020.png" alt="노임단가표" class="w-100 d-none">
        </article>
        <article>
            <a href="./calculator.html">
                <div class="calculator" onclick="calculator()">
                    <div class="calculator-circle">
                        <img src="./img/calculator-240.png" alt="calculator" class="calculator-icon">
                    </div>
                </div>
            </a>
        </article>
    </footer>

    <script>
        let table_tbody = document.querySelector('.description > tbody');
        let add_btn = document.querySelector('#add_btn');
        let tr_count = document.querySelector('#add_rows');
        add_btn.addEventListener('click', function(event){
            table_tbody.innerHTML+=`<tr>
                                        <th>${tr_count.value}</th>
                                        <td><select id="g_${tr_count.value}" class="options"><option value="1">초급</option></select></td>
                                        <td><input id="p_${tr_count.value}" class="options" type="number" value="1"><span class="mm">M</span></td>
                                        <td><input id="m_${tr_count.value}" class="options" type="number" value="1"><span class="mm">M</span></td>
                                        <td><input id="r_${tr_count.value}" class="options" type="number"><span class="mm">M/M</span></td>
                                    </tr>`
        });

        let total = document.querySelector('#total');
        
        let inputs = document.querySelectorAll('.options');
        for(let i = 0; i < inputs.length; i++){
            inputs[i].addEventListener('blur', function(event){
                input_blur();
                console.log(`i is ${i}`);
            });
        }

        function input_blur(){
            let table_tbody = document.querySelectorAll('tbody > tr');
            let total_result = 0;
            for(let i =1; i <= table_tbody.length; i++){
                let grade = document.getElementById('g_'+i);
                let people = document.getElementById('p_'+i);
                let month = document.getElementById('m_'+i);
                let result = document.getElementById('r_'+i);
                
                result.value = grade.value * people.value * month.value;
                total_result += Number(result.value);
            }
            
            total.value = total_result;
        }
        //단가표 펼치기/접기
        let toggle = document.getElementById('toggle');
        toggle.addEventListener('click', function(){
            let price = document.getElementById('price');
            let toggle_p = document.querySelector('#toggle p');
            let triangle = document.querySelector('.triangle');
            let calculator = document.querySelector('.calculator')
            //toggle 기능 img
            let isprice = price.classList.toggle('d-none');
            if(isprice){
                toggle_p.textContent = '펼치기';
                toggle_p.style.transform = 'rotate(0deg)';
                triangle.style.transform = 'rotate(0deg)';
                calculator.classList.remove('d-none');
            }else{
                toggle_p.textContent = '접기';
                toggle_p.style.transform = 'rotate(180deg)';
                triangle.style.transform = 'rotate(180deg)';
                calculator.classList.add('d-none');
            }
        });
    </script>

</body>
</html>
